<div id="vue-panel-info" class="flex column h100">
    <div class="title bbox flex acenter">
        <span class="flex_1">{{ nav_selected_2.name }}</span>
        <button class="close"><i class="iconfont icon-x"></i></button>
    </div>
    <div class="detail bbox flex acenter jcenter">
        <div class="distrible flex_1" v-if="info.name">
            <p>{{ info.name }}</p>
            <p>{{ info.tel }}</p>
            <p>{{ info.address || '' }}</p>
        </div>
        <div class="distrible flex_1" v-else-if="info.kid == 'road'">
            <p class="flex">
                <span class="flex_1">{{info.date.split(' ')[0]}}</span>
                <span>{{info.time}}</span>
            </p>
            <p class="flex">
                <span class="flex_1">{{info.hour}}小时</span>
                <span>{{info.km}}公里</span>
            </p>
            <p class="whitespace">{{ info.userName }}({{ info.tel }})</p>
        </div>
        <div class="distrible flex_1" v-else-if="info.kid == 'area'">
            <p>
                <span>{{info.areaname}}（{{info.areacode}}）</span>
            </p>
            <p>
                <span>{{info.area}}亩</span>
            </p>
            <p class="whitespace">{{ info.userName }}({{ info.tel }})</p>
        </div>
        <div class="distrible flex_1" v-else-if="info.kid == 'c119'">
            <p>
                <span>{{info.alarmname}}</span>
            </p>
            <p>
                <span>{{info.date}}</span>
            </p>
            <p class="whitespace">{{ info.userName }}({{ info.tel }})</p>
        </div>
        <div class="distrible flex_1" v-else-if="info.kid == 'hot'">
            <p>
                <span>{{info.hotname}}（{{info.hotsource}}）</span>
            </p>
            <p>
                <span>{{info.date}}</span>
            </p>
            <p class="whitespace">{{ info.userName }}({{ info.tel }})</p>
        </div>
        <div class="btnarea" :class="info.name ? 'aselfcenter' : 'aselfend'">
            <p :style="!info.name? 'margin-bottom: 4px' : ''">
                <i class="icons icon_31" @click="showDialog"></i>
                <i class="icons icon_32" @click="showDialog"></i>
                <i class="icons icon_33" @click="showDialog"></i>
            </p>
            <p v-if="info.UserInfo">
                <button>跟踪</button>
            </p>
        </div>
    </div>
    <div class="tabs flex acenter">
        <span v-for="(item,index) in menus" :key="index" @click="selectNav(index)" :class="{'selected': index==selected}">
            <i class="icons" :class="item.clsName"></i>{{item.name}}
        </span>
    </div>
    <div class="tabdetail flex_1 scroll">
        <div id="panelnavdetail" class="h100 scroll"></div>
    </div>
</div>

<script>
    (function(){
        var _options = JSON.parse(sessionStorage.getItem('_panel_info_options_') || '{}');
        var _menus = SECONDMENUS.filter(function(i){
            return i.id == _options.pageId;
        })[0];
        if(!_menus) return $('#vue-panel-info').load('views/500.html');
        new Vue({
            el: '#vue-panel-info',
            data: {
                info: {
                    name: '',
                    tel: '',
                    address: '',
                    kid: ''
                },
                selected: -1,
                menus: _menus.panelMenus || [],
                nav_selected_2: _menus,
                options: _options,
                cacheds: [false, false, false, false, false]
            },
            created: function () {
                var info = JSON.parse(sessionStorage.getItem('_panel_info_') || '{}');
                this.selected = 0;
                if(info.UserInfo) {
                    this.info.name = info.UserInfo.USER_NAME;
                    this.info.tel = info.UserInfo.PHONE_NUM;
                    this.info.address = info.UserInfo.SNAME + info.UserInfo.XNAME;
                } else if(info.LineInfo) {
                    this.info = info.LineInfo;
                } else if(info.AreaInfo) {
                    this.info = info.AreaInfo;
                } else if(info.C119Info) {
                    this.info = info.C119Info;
                } else if(info.HotInfo) {
                    this.info = info.HotInfo;
                }
            },
            mounted: function () {
                var self = this;
                var nav_selected_2 = sessionStorage.getItem('_2_nav_selected_');
                var old_idx = sessionStorage.getItem('_panel_nav_selected_');
                this.selectNav(0);
                if(this.info.kid == nav_selected_2) {
                    self.selectNav(old_idx || 0);
                }
            },
            methods: {
                selectNav: function(val){
                    this.selected = val;
                    var item = this.menus[val], targetId;
                    sessionStorage.setItem('_panel_nav_selected_', val);
                    targetId = 'infoPanel_item_' + item.id;
                    if (!this.cacheds[val]) {
                        this.cacheds[val] = true;
                        $('#panelnavdetail').append($('<div id="'+ targetId +'" class="h100 w100 hidden"></div>').load(item.link));
                    }
                    $('#' + targetId).show().siblings().hide();
                },
                showDialog: function () {
                    $.ligerDialog.open({
                        height: 600,
                        width: 800,
                        title : '打开窗口提示',
                        url: 'views/dialogs/blank.html', 
                        isResize: true,
                        data: {
                            name: +new Date()
                        },
                        //自定义参数
                        myDataName: '$("#txtValue").val()'
                    });
                }
            }
        })
    })();
</script>